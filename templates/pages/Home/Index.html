
    {% extends "base/base.html" %}

    {% load duration_filters %}

    {% load static %}
    
    {% block extra_css %}
        <link rel="stylesheet" href={% static '/css/home/index.css' %}>
    {% endblock extra_css %}

    

    {% block title %}
        Home
    {% endblock title %}


    {% block content %}
    
        <main class="main-content">
            <section class="welcome-section">
                <div class="welcome-card">
                    <div class="welcome-content">
                        <h1>Welcome back, Music Lover! üéß</h1>
                        <p>{{ user.username }}! Here's what's happening in your musical universe</p>
                    </div>
                    
                    {% if total_listening_minutes %}
                        <div class="welcome-stats">
                            <div class="stat-item">
                                <div class="stat-number">{{ recentPlayed.count }}</div>
                                <div class="stat-label">Recent Tracks</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">{{ total_listening_minutes }}</div>
                                <div class="stat-label">Minutes Listened</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">{{ top_artists.count }}</div>
                                <div class="stat-label">Top Artists</div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </section>

            <div class="content-grid">
                <section class="card top-artists">
                    <h2>Your Top Artists</h2>
                    <div class="artists-list">
                        {% for artist in top_artists %}
                        <div class="artist-item">
                            {% if artist.artist_image %}
                            <img src="{{ artist.artist_image }}" alt="{{ artist.artist_name }}" class="artist-avatar">
                            {% else %}
                            <div class="artist-avatar gradient-{{ forloop.counter }}">
                                {{ artist.artist_name|slice:":2"|upper }}
                            </div>
                            {% endif %}
                            <div class="artist-info">
                                <span class="artist-name clamp">{{ artist.artist_name }}</span>
                                <span class="play-count">{{ artist.total_played }} plays</span>
                            </div>
                            <div class="trend up">‚ÜóÔ∏è</div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <p>No top artists yet. Start listening to build your collection!</p>
                        </div>
                        {% endfor %}
                    </div>
                </section>

                <!-- Listening Activity Section -->
                <section class="card listening-activity">
                    <h2>Listening Activity</h2>
                    <div class="activity-chart">
                        <div class="chart-bars">
                            {% for day in listening_minutes %}
                            <div class="bar {% if day.is_today %}active{% endif %}" 
                                style="height: {% widthratio day.minutes 120 100 %}%"
                                title="{{ day.day_name }}: {{ day.minutes }} minutes">
                            </div>
                            {% endfor %}
                        </div>
                        
                        <div class="chart-labels">
                            {% for day in listening_minutes %}
                            <span>{{ day.day_abbr }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% if not listening_minutes %}
                    <div class="empty-state">
                        <p>No listening data available yet.</p>
                    </div>
                    {% endif %}
                </section>

                <!-- Recently Played Section -->
                <section class="card recent-tracks">
                    <h2>Recently Played</h2>
                    <div class="tracks-list">
                        {% for track in recentPlayed %}
                        <div class="track-item">
                            {% if track.track_image %}
                            <img src="{{ track.track_image }}" alt="{{ track.track_name }}" class="track-art">
                            {% else %}
                            <div class="track-art gradient-{{ forloop.counter|add:3 }}">
                                {{ track.track_name|slice:":1"|upper }}
                            </div>
                            {% endif %}
                            <div class="track-details">
                                <span class="track-name">{{ track.track_name }}</span>
                                <span class="track-artist">{{ track.track_owner }}</span>
                            </div>
                            <div class="track-time">
                                {{ track.track_duration|format_duration }}
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <p>No recently played tracks. Play some music to get started!</p>
                        </div>
                        {% endfor %}
                    </div>
                </section>

                <!-- Genre Distribution Section -->
                <section class="card genre-distribution">
                    <h2>Your Music DNA</h2>
                    <div class="genre-chart">
                        {% for music_type in music_types %}
                        <div class="genre-item">
                            <div class="genre-bar">
                                <div class="genre-fill" style="width: {{ music_type.normalized_percentage }}%"></div>
                            </div>
                            <div class="genre-info">
                                <span>{{ music_type.music_type }}</span>
                                <span>{{ music_type.normalized_percentage }}%</span>
                            </div>
                        </div>
                        {% empty %}
                            <div class="genre-item">
                                <div class="genre-bar">
                                    <div class="genre-fill" style="width: 85%"></div>
                                </div>
                                <div class="genre-info">
                                    <span>Pop</span>
                                    <span>85%</span>
                                </div>
                            </div>
                            <div class="genre-item">
                                <div class="genre-bar">
                                    <div class="genre-fill" style="width: 65%"></div>
                                </div>
                                <div class="genre-info">
                                    <span>R&B</span>
                                    <span>65%</span>
                                </div>
                            </div>
                            <div class="genre-item">
                                <div class="genre-bar">
                                    <div class="genre-fill" style="width: 45%"></div>
                                </div>
                                <div class="genre-info">
                                    <span>Electronic</span>
                                    <span>45%</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </section>

                <section class="card quick-actions">
                    <h2>Quick Actions</h2>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="shufflePlay()">
                            <span class="action-icon">üîÄ</span>
                            <span>Shuffle Play</span>
                        </button>
                        <button class="action-btn" onclick="viewStats()">
                            <span class="action-icon">üìä</span>
                            <span>View Stats</span>
                        </button>
                        <button class="action-btn" onclick="discoverMusic()">
                            <span class="action-icon">üéµ</span>
                            <span>Discover</span>
                        </button>
                        <button class="action-btn" onclick="createMix()">
                            <span class="action-icon">‚ö°</span>
                            <span>Create Mix</span>
                        </button>
                    </div>
                </section>
            </div>      
        </main>
    {% endblock content %}

    <script src={% static 'js/home/index.js' %}></script>